<div ng-if="!request.allowAccess && request.viewReady" class="alert alert-danger" role="alert">
  <div dynamic-content="$root.MESSAGES.mptool_invalid_access.content | html"></div>
</div>

<div ng-if="request.allowAccess">
  <preloader full-screen="true" ng-show="!request.viewReady"> </preloader>
  <div ng-if="request.viewReady"  class="col-md-6 col-md-offset-3"> 
    <h1> Childcare Request </h1>
    <form name="request.childcareRequestForm" novalidate ng-submit="request.submit()">

      <div class="form-group" ng-class="{'has-error': request.validateField('congregation')}">
      	<label class="control-label required" for="congregation">Site</label>
      	<select name="congregation" 
                class="form-control"
                ng-options="congregation.dp_RecordName for congregation in request.congregations track by congregation.dp_RecordID" 
                ng-model="request.choosenCongregation"
                required 
                ng-change="request.getGroups()">
          <option value=""> -- Choose your Site -- </option>
      	</select>
        <ng-messages for="request.childcareRequestForm.congregation.$error" ng-if="request.validateField('congregation')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <div class="form-group" ng-class="{'has-error': request.validateField('ministry')}">
      	<label class="control-label required" for="ministry">Ministry</label>
      	<select name="ministry"
                class="form-control"
                ng-model="request.choosenMinistry"
                required
                ng-change="request.getGroups()"
                ng-options="ministry.dp_RecordName for ministry in request.ministries track by ministry.dp_RecordID">
          <option value=""> -- Choose your Ministry -- </option>
      	</select>
        <ng-messages for="request.childcareRequestForm.ministry.$error" ng-if="request.validateField('ministry')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <preloader full-screen="false" ng-show="request.loadingGroups"> </preloader>

      <div class="form-group" ng-class="{'has-error': request.validateField('group')}" ng-show="request.showGroups()">
      	<label class="control-label required" for="group">Group</label>
      	<select class="form-control" 
                name="group"
                ng-model="request.choosenGroup"
                required
                ng-options="group.dp_RecordName for group in request.groups track by group.dp_RecordID" >
          <option value=""> -- Choose your Group -- </option>
      	</select>
        <ng-messages for="request.childcareRequestForm.group.$error" ng-if="request.validateField('group')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <div class="form-group"  ng-show="request.choosenGroup">
        <date-range required="true"
                    start-date="request.startDate"
                    end-date="request.endDate"
                    min-date="request.minDate"
                    start-date-change="request.onStartDateChange(startDate)">
          Date Range
        </date-range>
      </div>

      <div class="form-group" ng-class="{'has-error': request.validateField('frequency')}" ng-show="request.choosenGroup">
      	<label class="control-label required" for="frequency">Frequency</label>
      	<select class="form-control" 
                name="frequency" 
                ng-model="request.choosenFrequency"
                required>
          <option value=""> -- Please choose a Frequency -- </option>
          <option value="Once"> Once </option>
          <option value="Weekly"> Weekly </option>
          <option value="Monthly"> Monthly </option>
        </select>
        <ng-messages for="request.childcareRequestForm.frequency.$error" ng-if="request.validateField('frequency')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <div class="form-group" ng-class="{'has-error': request.validateField('preferredTime')}" ng-show="request.choosenGroup">
      	<label class="control-label required" for="preferredTime">Preferred Time</label>
      	<select name="preferredTime"
                class="form-control"
                ng-model="request.choosenPreferredTime"
                required
                ng-options="request.formatPreferredTime(time) for time in request.filteredTimes track by time.dp_RecordID" >
      		<option value="">-- Please choose a preferred time --</option>
      	</select>
        <ng-messages for="request.childcareRequestForm.preferredTime.$error" ng-if="request.validateField('preferredTime')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <div class="form-group" ng-class="{'has-error': request.validateField('childrenAttending')}" ng-show="request.choosenGroup" >
      	<label class="control-label required" for="childrenAttending">Estimated # of Children</label>
      	<input type="number" name="childrenAttending" class="form-control" min="0" ng-model="request.numberOfChildren" required />
        <ng-messages for="request.childcareRequestForm.childrenAttending.$error" ng-if="request.validateField('childrenAttending')">
          <span ng-message="required">
            <span dynamic-content="$root.MESSAGES.fieldCanNotBeBlank.content | html"></span>
          </span>
          <span ng-message='number'> 
            <span dynamic-content="$root.MESSAGES.invalidNumber.content | html"></span>
          </span>
        </ng-messages>
      </div>

      <div class="form-group" ng-show="request.choosenGroup">
      	<label class="control-label" for="notes">Notes</label>
      	<textarea class="form-control" name="notes" ng-model="request.notes" placeholder="Enter any additional details here." />
      </div>

      <div class="form-group" >
      	<input class="btn btn-primary btn-standard pull-right"
               type="submit" 
               value="Submit" 
               ng-disabled="request.childcareRequestForm.$invalid || request.saving">
      </div>

    </form>
  </div>
</div>
